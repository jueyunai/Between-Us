<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>情感客厅调试</title>
</head>
<body>
    <h1>情感客厅数据调试</h1>
    <div id="debug-info"></div>
    
    <script>
        async function debugLounge() {
            const debugDiv = document.getElementById('debug-info');
            let html = '';
            
            try {
                // 1. 获取用户信息
                html += '<h2>1. 用户信息</h2>';
                const userRes = await fetch('/api/user/info');
                const userData = await userRes.json();
                html += `<pre>${JSON.stringify(userData, null, 2)}</pre>`;
                
                if (!userData.success) {
                    html += '<p style="color:red">❌ 未登录，请先登录</p>';
                    debugDiv.innerHTML = html;
                    return;
                }
                
                // 2. 获取房间信息
                html += '<h2>2. 房间信息</h2>';
                const roomRes = await fetch('/api/lounge/room');
                const roomData = await roomRes.json();
                html += `<pre>${JSON.stringify(roomData, null, 2)}</pre>`;
                
                if (!roomData.success) {
                    html += '<p style="color:red">❌ 无法获取房间</p>';
                    debugDiv.innerHTML = html;
                    return;
                }
                
                // 3. 获取历史记录
                html += '<h2>3. 历史记录</h2>';
                const historyRes = await fetch('/api/lounge/history');
                const historyData = await historyRes.json();
                html += `<p>成功: ${historyData.success}</p>`;
                html += `<p>消息数量: ${historyData.messages ? historyData.messages.length : 0}</p>`;
                
                if (historyData.messages && historyData.messages.length > 0) {
                    html += '<h3>前10条消息:</h3><ul>';
                    historyData.messages.slice(0, 10).forEach((msg, i) => {
                        const role = msg.role === 'assistant' ? '教练' : `用户${msg.user_id}`;
                        html += `<li>[${role}] ${msg.content.substring(0, 50)}...</li>`;
                    });
                    html += '</ul>';
                } else {
                    html += '<p style="color:orange">⚠️ 没有历史消息</p>';
                }
                
            } catch (error) {
                html += `<p style="color:red">❌ 错误: ${error.message}</p>`;
            }
            
            debugDiv.innerHTML = html;
        }
        
        // 页面加载后执行
        debugLounge();
    </script>
</body>
</html>
