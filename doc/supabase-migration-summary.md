# Supabase è¿ç§»å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆå·¥ä½œ

### 1. æ ¸å¿ƒæ–‡ä»¶åˆ›å»º
- âœ… `storage_supabase.py` - Supabase å­˜å‚¨å±‚å®ç°ï¼ˆå®Œå…¨å…¼å®¹åŸæ¥å£ï¼‰
- âœ… `supabase_schema.sql` - æ•°æ®åº“è¡¨ç»“æ„å®šä¹‰
- âœ… `migrate_to_supabase.py` - è‡ªåŠ¨æ•°æ®è¿ç§»è„šæœ¬
- âœ… `setup_supabase.sh` - å¿«é€Ÿé…ç½®å‘å¯¼è„šæœ¬

### 2. æ–‡æ¡£æ›´æ–°
- âœ… `doc/supabase-migration-guide.md` - è¯¦ç»†è¿ç§»æŒ‡å—
- âœ… `doc/decision-log.md` - æŠ€æœ¯å†³ç­–è®°å½•
- âœ… `README.md` - æ·»åŠ  Supabase ä½¿ç”¨è¯´æ˜
- âœ… `.env.example` - æ·»åŠ  Supabase é…ç½®ç¤ºä¾‹

### 3. ä¾èµ–æ›´æ–°
- âœ… `requirements.txt` - æ·»åŠ  `supabase==2.3.4`

## ğŸ“‹ è¿ç§»æ–¹æ¡ˆç‰¹ç‚¹

### æ–¹æ¡ˆ Aï¼ˆæœ€å°æ”¹åŠ¨ï¼‰
- **æ”¹åŠ¨èŒƒå›´**ï¼šä»…å­˜å‚¨å±‚ï¼ˆ`storage.py` â†’ `storage_supabase.py`ï¼‰
- **ä¸šåŠ¡é€»è¾‘**ï¼š`app.py` åªéœ€ä¿®æ”¹ 1 è¡Œå¯¼å…¥è¯­å¥
- **æ¥å£å…¼å®¹**ï¼š100% å…¼å®¹åŸæœ‰æ¥å£
- **å›æ»šæˆæœ¬**ï¼šæä½ï¼Œæ”¹å›å¯¼å…¥å³å¯

### æŠ€æœ¯å®ç°
```python
# åŸæ¥å£ä¿æŒä¸å˜
User.get(id)              # æ ¹æ® ID è·å–ç”¨æˆ·
User.filter(**kwargs)     # æ¡ä»¶è¿‡æ»¤
User.all()                # è·å–æ‰€æœ‰
user.save()               # ä¿å­˜/æ›´æ–°

# åº•å±‚è‡ªåŠ¨åˆ‡æ¢åˆ° Supabase PostgreSQL
```

## ğŸ¯ ä¸‹ä¸€æ­¥æ“ä½œæŒ‡å¼•

### ç¬¬ 1 æ­¥ï¼šé…ç½® Supabaseï¼ˆ5 åˆ†é’Ÿï¼‰

1. è®¿é—® https://supabase.com æ³¨å†Œè´¦å·
2. åˆ›å»ºæ–°é¡¹ç›®ï¼ˆé€‰æ‹©ç¦»ä½ æœ€è¿‘çš„åŒºåŸŸï¼‰
3. åœ¨ SQL Editor ä¸­æ‰§è¡Œ `supabase_schema.sql`
4. åœ¨ Settings â†’ API è·å–ï¼š
   - Project URL
   - anon public key

### ç¬¬ 2 æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡ï¼ˆ1 åˆ†é’Ÿï¼‰

**æ–¹å¼ä¸€ï¼šä½¿ç”¨é…ç½®è„šæœ¬ï¼ˆæ¨èï¼‰**
```bash
bash setup_supabase.sh
```

**æ–¹å¼äºŒï¼šæ‰‹åŠ¨é…ç½®**
```bash
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œæ·»åŠ ï¼š
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your-anon-key-here
```

### ç¬¬ 3 æ­¥ï¼šå®‰è£…ä¾èµ–ï¼ˆ1 åˆ†é’Ÿï¼‰

```bash
pip install supabase python-dotenv
```

### ç¬¬ 4 æ­¥ï¼šæ•°æ®è¿ç§»ï¼ˆå¯é€‰ï¼Œ2 åˆ†é’Ÿï¼‰

å¦‚æœæœ‰ç°æœ‰ JSON æ•°æ®ï¼š
```bash
python migrate_to_supabase.py
```

å¦‚æœæ˜¯æ–°é¡¹ç›®ï¼Œè·³è¿‡æ­¤æ­¥éª¤ã€‚

### ç¬¬ 5 æ­¥ï¼šä¿®æ”¹ä»£ç ï¼ˆ30 ç§’ï¼‰

åœ¨ `app.py` ç¬¬ 4 è¡Œï¼Œå°†ï¼š
```python
from storage import User, Relationship, CoachChat, LoungeChat
```

æ”¹ä¸ºï¼š
```python
from storage_supabase import User, Relationship, CoachChat, LoungeChat
```

### ç¬¬ 6 æ­¥ï¼šå¯åŠ¨æµ‹è¯•ï¼ˆ1 åˆ†é’Ÿï¼‰

```bash
python app.py
```

è®¿é—® http://localhost:7860 æµ‹è¯•ä»¥ä¸‹åŠŸèƒ½ï¼š
- [ ] ç”¨æˆ·æ³¨å†Œ
- [ ] ç”¨æˆ·ç™»å½•
- [ ] ç”Ÿæˆç»‘å®šç 
- [ ] ä¼´ä¾£ç»‘å®š
- [ ] ä¸ªäººæ•™ç»ƒèŠå¤©
- [ ] æƒ…æ„Ÿå®¢å…èŠå¤©

### ç¬¬ 7 æ­¥ï¼šéªŒè¯æ•°æ®ï¼ˆ1 åˆ†é’Ÿï¼‰

åœ¨ Supabase Dashboard â†’ Table Editor æŸ¥çœ‹æ•°æ®æ˜¯å¦æ­£ç¡®ä¿å­˜ã€‚

## ğŸ” å¸¸è§é—®é¢˜

### Q1: å¦‚æœ Supabase é…ç½®é”™è¯¯æ€ä¹ˆåŠï¼Ÿ
**A**: æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„ `SUPABASE_URL` å’Œ `SUPABASE_KEY` æ˜¯å¦æ­£ç¡®ã€‚

### Q2: å¦‚ä½•å›æ»šåˆ° JSON å­˜å‚¨ï¼Ÿ
**A**: åœ¨ `app.py` ä¸­æ”¹å› `from storage import ...` å³å¯ã€‚

### Q3: æ•°æ®è¿ç§»å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
**A**: 
1. æ£€æŸ¥ Supabase è¡¨æ˜¯å¦å·²åˆ›å»ºï¼ˆæ‰§è¡Œ `supabase_schema.sql`ï¼‰
2. æ£€æŸ¥ç½‘ç»œè¿æ¥
3. æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼Œæ‰‹åŠ¨ä¿®å¤

### Q4: å¦‚ä½•æŸ¥çœ‹ Supabase ä¸­çš„æ•°æ®ï¼Ÿ
**A**: ç™»å½• Supabase Dashboard â†’ Table Editor â†’ é€‰æ‹©è¡¨æŸ¥çœ‹ã€‚

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | JSON æ–‡ä»¶ | Supabase |
|------|----------|----------|
| å¹¶å‘æ”¯æŒ | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| æŸ¥è¯¢æ€§èƒ½ | ğŸŒ æ…¢ï¼ˆå…¨è¡¨æ‰«æï¼‰ | âš¡ å¿«ï¼ˆç´¢å¼•ä¼˜åŒ–ï¼‰ |
| æ•°æ®å¤‡ä»½ | âŒ æ‰‹åŠ¨ | âœ… è‡ªåŠ¨ |
| ç®¡ç†ç•Œé¢ | âŒ æ—  | âœ… Web UI |
| å®æ—¶è®¢é˜… | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| å…è´¹é¢åº¦ | âœ… æ— é™ | âœ… 500MB æ•°æ®åº“ |

## ğŸ“ è¿›é˜¶ä¼˜åŒ–å»ºè®®

### 1. å¯ç”¨è¡Œçº§å®‰å…¨ç­–ç•¥ï¼ˆRLSï¼‰
ä¿æŠ¤ç”¨æˆ·æ•°æ®éšç§ï¼Œç¡®ä¿ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®ã€‚

### 2. ä½¿ç”¨ Supabase Realtime
æ›¿ä»£å½“å‰çš„ WebSocket å®ç°ï¼Œå®ç°çœŸæ­£çš„å®æ—¶åŒæ­¥ã€‚

### 3. æ·»åŠ å…¨æ–‡æœç´¢
åˆ©ç”¨ PostgreSQL çš„å…¨æ–‡æœç´¢åŠŸèƒ½ï¼Œæœç´¢èŠå¤©è®°å½•ã€‚

### 4. æ•°æ®åˆ†æ
ä½¿ç”¨ SQL åˆ†æç”¨æˆ·è¡Œä¸ºï¼Œç”Ÿæˆç»Ÿè®¡æŠ¥è¡¨ã€‚

## ğŸ“ è·å–å¸®åŠ©

- **è¯¦ç»†æ–‡æ¡£**ï¼š`doc/supabase-migration-guide.md`
- **æŠ€æœ¯å†³ç­–**ï¼š`doc/decision-log.md`
- **Supabase å®˜æ–¹æ–‡æ¡£**ï¼šhttps://supabase.com/docs

## ğŸ“ æ€»ç»“

âœ… **è¿ç§»å‡†å¤‡å®Œæˆ**ï¼Œæ‰€æœ‰æ–‡ä»¶å·²å°±ç»ª  
âœ… **æ¥å£å®Œå…¨å…¼å®¹**ï¼Œä¸šåŠ¡é€»è¾‘æ— éœ€ä¿®æ”¹  
âœ… **æ–‡æ¡£é½å…¨**ï¼Œé…ç½®è„šæœ¬å¯ç”¨  
âœ… **å›æ»šç®€å•**ï¼Œé£é™©å¯æ§  

**é¢„è®¡æ€»è€—æ—¶**ï¼š10-15 åˆ†é’Ÿï¼ˆå« Supabase æ³¨å†Œå’Œé…ç½®ï¼‰

---

**å®Œæˆæ—¶é—´**ï¼š2026-01-18  
**è¿ç§»æ–¹å¼**ï¼šæ–¹æ¡ˆ Aï¼ˆæœ€å°æ”¹åŠ¨ï¼‰  
**çŠ¶æ€**ï¼šâœ… ä»£ç å°±ç»ªï¼Œç­‰å¾…é…ç½®å’Œæµ‹è¯•
